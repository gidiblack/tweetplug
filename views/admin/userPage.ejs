<!DOCTYPE html>
<html lang="en">
     <%- include('../partials/head'); -%>
<body>
     <%- include('../partials/adminNav'); -%>
    <main>
        <section>
            <div class="container">
                <!-- User Profile Summary -->
                <h2 class="mb-4">Profile Summary</h2>
                <div id="user-summary">
                    <form action="/admin/user/status?_method=PATCH" method="post">
                    <p>Full Name: <span id="fullName"><%=user.firstname %> <%=user.lastname %></span></p>
                    <p>Username: <span id="username"><%= user.username %></span></p>
                    <p>Total Revenue: <span id="totalRevenue">&#8358;Total revenue</span></p>
                    <p>Current Plan: <span id="currentPlan"><%= user.Plan %></span></p>
                    <p>Withdrawal Request: <span id="withdraw-request">Withdrawal</span></p>
                    <p>Remaining Duration: <span id="remainingDuration">Duration</span></p>
                    <p>Account Name: <span id="accountName"><%= user.bankAccountName %></span></p>
                    <p>Account Number: <span id="accountNumber"><%=user.bankAccountNumber %></span></p>
                    <p>Bank: <span id="bank"><%=user.bank %></span></p>
                    <p>Active User: <span id="status"><%=user.active %></span></p>
                    <p>Today's Acton: <span id="todayAction">CHeck open</span></p>
                    <input type="hidden" name="user_id" value=<%=user._id %>>
                    <input type="submit" value="Change Plan" name="user_p">
                    <input type="submit" value="Suspend Account" class="sec-btn" name="user_s">
                    <input type="submit" value="Delete Account" class="del-btn" name="user_d">
                    
                    </form>
                </div>
            </div>
        </section>
        <section>
            <div class="container action-confirm">
                <!-- Today's Action confirmation -->
                <h2 class="mb-5">Today's Action</h2>
                <form action="/admin/links/setstatus?_method=PATCH" id="" method="POST">
                <% user.links.forEach((link, index) => { %>
                    <fieldset class="form-group">
                        <label for="tweet-link-1">Tweet link # <%=index + 1 %>:</label>
                        <input type="text" class="form-control" 
                        id="tweet-link-1" value="<%=link.link%>">
                    </fieldset>
                <% }) %>
                    <input type="hidden" name="user_id" value="<%=user._id%>">
                    <button type="submit"class="mt-3">Confirm Tweets</button>
                </form>
            </div>
        </section>
    </main>
     <!-- Withdrawal History -->
     <section class="withdraw-history">
        <div class="container">
            <h2>Withdrawal Request</h2>
            <!-- table -->
            <form action="/admin/withdrawals/setstatus?_method=PATCH" method="POST">
            <table style="width:100%" class="my-5 pl-1">
                <tr>
                <th>#</th>
                <th>DATE</th>
                <th>AMOUNT</th> 
                <th>STATUS</th>
                </tr>
                <% if (user.withdrawals[0] == undefined || user.withdrawals[0  + user.withdrawals.length -1].status =='approved' || user.withdrawals[0  + user.withdrawals.length -1].status =='rejected' ) {%>
                <tr>
                <td>Nil</td>
                <td>Nil</td>
                <td>&#8358;Nil</td>
                <td>Nil</td>
                </tr>
                <% } else if (user.withdrawals[0  + user.withdrawals.length -1].status =='unconfirmed' ) { %>
                <tr>
                <td>1</td>
                <td><%= moment(user.withdrawals[0  + user.withdrawals.length -1].createdAt).format('MMMM Do YYYY') %></td>
                <td>&#8358;<%= user.withdrawals[0  + user.withdrawals.length -1].amount %></td>
                <td><%= user.withdrawals[0  + user.withdrawals.length -1].status %></td>
                </tr>
                <input type="hidden" name="userId" value="<%=user._id %>">
                <input type="hidden" name="withdrawalID" value = "<%= user.withdrawals[0  + user.withdrawals.length -1]._id %>">
                <% } %>
            </table>
             <% if (user.withdrawals[0] == undefined || user.withdrawals[0  + user.withdrawals.length -1].status =='approved' || user.withdrawals[0  + user.withdrawals.length -1].status =='rejected' ) {%>
            <p>No requests made yet</p>
            <% } else if (user.withdrawals[0  + user.withdrawals.length -1].status =='unconfirmed' ) { %>
            <input type="submit" name="withdrawB" value="Confirm_Withdrawal"> 
            <input type="submit" name="withdrawB" value="Deny_Withdrawal" class="del-btn"> 
            <% } %>
            </form>
        </div>
    </section>
     <section class="withdraw-history">
        <div class="container">
            <h2>Withdrawal History</h2>
            <!-- table -->
            <table style="width:100%" class="my-5 pl-1">
                <tr>
                <th>#</th>
                <th>DATE</th>
                <th>AMOUNT</th> 
                <th>STATUS</th>
                </tr>
                <% user.withdrawals.forEach((withdrawal,index) => {%>
                <tr>
                <td><%= index +1 %></td>
                <td><%=moment(withdrawal.createdAt).format('MMMM Do YYYY') %> </td>
                <td>&#8358;<%= withdrawal.amount %></td>
                <td><%= withdrawal.status %></td>
                </tr>
                <% }) %>
            </table>
        </div>
    </section>
     <%- include('../partials/footer'); -%>
</body>
     <%- include('../partials/scripts'); -%>
</html>